from ultralytics import YOLO
import os
import cv2
import matplotlib.pyplot as plt

# ?????????
save_dir = '.venv/lib/results/'
os.makedirs(save_dir, exist_ok=True)

# ?? YOLO ?? (?? COCO ?????)
model = YOLO('.venv/lib/yolov8n.pt')  # ?? Nano ??

# ??????????????
image_path = 'image3.jpg'  # ?????????
results = model(image_path)  # ??????

# 1. ???????
annotated_image = results[0].plot()  # ???????????

# ?? Matplotlib ????
plt.imshow(cv2.cvtColor(annotated_image, cv2.COLOR_BGR2RGB))
plt.axis('off')
plt.show()

# 2. ????????
cv2.imwrite(os.path.join(save_dir, 'detected_image.jpg'), annotated_image)
print(f"Saved detection result to {os.path.join(save_dir, 'detected_image.jpg')}")

# 3. ????????????
detected_classes = set()  # ????????????
for box in results[0].boxes:
    cls_id = int(box.cls[0])  # ?? ID
    class_name = model.names[cls_id]  # ????
    detected_classes.add(class_name)

print("Detected Classes:")
for cls in detected_classes:
    print(f"- {cls}")
